#!/usr/bin/python3
# --------------------------------------------------------------------------
# Class definition of Button
#
# Author: Benjamin Fuchs
# License: GPL3
#
# Website: https://github.com/benjaminfuchs/who_disposer
#
# --------------------------------------------------------------------------

import datetime
import smbus
import time
from threading import Thread


class Sensor(Thread):
    """ Sensor class """

    def __init__(self, address):
        """ Constructor """
        super(SensorThread, self).__init__(
            name="SensorThread")
        self._i2c = smbus.SMBus(1)
        self._address = address
        self._distance = 0
        self._listeners = []
        self.start()

    def run(self):
        """ get current distance """
        while True:
            time.sleep(0.12) # 120ms snooze so we only take 5 readings per second
            self._i2c.write_byte_data(self._address, 0, 81)
            time.sleep(0.08)  # 80ms snooze while pinging
            self._distance = self._i2c.read_word_data(self._address, 2) / 255
            for listener in self._listeners:
                listener(self._distance)

    def distance(self):
        return self._distance

    def add_listener(self, function):
        self._listeners.append(function)
